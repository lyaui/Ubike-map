{"remainingRequest":"/Users/huangpei-yu/ubike-map/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/huangpei-yu/ubike-map/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/huangpei-yu/ubike-map/src/App.vue","mtime":1590225081285},{"path":"/Users/huangpei-yu/ubike-map/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/ubike-map/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/ubike-map/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/huangpei-yu/ubike-map/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/huangpei-yu/ubike-map/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBUYWlwZWkgZnJvbSAnQC9hc3NldHMvYXJlYS5qc29uJzsKaW1wb3J0IEwgZnJvbSAnbGVhZmxldCc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1ViaWtlLW1hcCcsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNpdHlNZW51OiBbXSwKICAgICAgYXJlYU1lbnU6IFtdLAogICAgICB1YmlrZXM6IFtdLAogICAgICBzZWxlY3RlZDogeyBjaXR5OiAn6Ie65YyX5biCJywgYXJlYTogJ+iQrOiPr+WNgCcgfSwKICAgICAgb3NtTWFwOiB7fSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgc2VsZWN0ZWRBcmVhKCkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiB2bS51YmlrZXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtLnNhcmVhID09PSB2bS5zZWxlY3RlZC5hcmVhKTsKICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgc2VsZWN0ZWRBcmVhKCkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CiAgICAgIHZtLnVwZGF0ZU1hcmtlcnMoKTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICB1cGRhdGVNYXJrZXJzKCkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CgogICAgICAvLyDnp7vpmaTmqJnoqJjvvIzkvb/nlKggaW5zdGFuY2VvZiDliKTmlrfmmK/lkKbmmK9tYXJrZXLnianku7bvvIzlpoLmnpzmmK/lsLHnp7vpmaQKICAgICAgdm0ub3NtTWFwLmVhY2hMYXllcigobGF5ZXIpID0+IHsKICAgICAgICBpZiAobGF5ZXIgaW5zdGFuY2VvZiBMLk1hcmtlcikgewogICAgICAgICAgdm0ub3NtTWFwLnJlbW92ZUxheWVyKGxheWVyKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8g5paw5aKe5qiZ6KiY44CBcG9wdXAKICAgICAgdm0uc2VsZWN0ZWRBcmVhLmZvckVhY2goKGFyZWEpID0+IHsKICAgICAgICBMLm1hcmtlcihbYXJlYS5sYXQsIGFyZWEubG5nXSkuYWRkVG8odm0ub3NtTWFwKS5iaW5kUG9wdXAoYDxwPjxzdHJvbmcgc3R5bGU9ImZvbnQtc2l6ZTogMjBweDsiPiR7YXJlYS5zbmF9PC9zdHJvbmc+PC9wPgogPHN0cm9uZyBzdHlsZT0iZm9udC1zaXplOiAxNnB4OyBjb2xvcjogI2Q0NTM0NTsiPuWPr+enn+WAn+i7iui8m+WJqemkmO+8miR7YXJlYS5zYml9IOWPsDwvc3Ryb25nPjxicj4KIOWPr+WBnOepuuS9jeWJqemkmDogJHthcmVhLmJlbXB9PGJyPgogPHNtYWxsPuacgOW+jOabtOaWsOaZgumWkzogJHthcmVhLm1kYXl9PC9zbWFsbD5gKTsKICAgICAgfSk7CgogICAgICAvLyDnp7vli5XkuK3lv4Ppu54KICAgICAgdm0ub3NtTWFwLnBhblRvKFt2bS5zZWxlY3RlZEFyZWFbMF0ubGF0LCB2bS5zZWxlY3RlZEFyZWFbMF0ubG5nXSk7CiAgICB9LAogIH0sCiAgY3JlYXRlZCgpIHsKICAgIGNvbnN0IHZtID0gdGhpczsKICAgIHZtLmNpdHlNZW51ID0gW1RhaXBlaVswXS5uYW1lXTsKICAgIHZtLmFyZWFNZW51ID0gVGFpcGVpWzBdLmRpc3RyaWN0cy5tYXAoKGFyZWEpID0+IGFyZWEubmFtZSk7CiAgICBjb25zdCBhcGkgPSAnaHR0cHM6Ly90Y2didXNmcy5ibG9iLmNvcmUud2luZG93cy5uZXQvYmxvYnlvdWJpa2UvWW91QmlrZVRQLmpzb24nOwogICAgdm0uJGh0dHAuZ2V0KGFwaSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgdm0udWJpa2VzID0gcmVzcG9uc2UuZGF0YS5yZXRWYWw7CiAgICAgIC8vIOS9v+eUqCBPYmplY3Qua2V5c+eNsuWPlnt7fSx7fSx7fSx7fSx7fX3nmoTmlrnlvI8KICAgICAgdm0udWJpa2VzID0gT2JqZWN0LmtleXModm0udWJpa2VzKS5tYXAoKGtleSkgPT4gdm0udWJpa2VzW2tleV0pOwogICAgfSk7CiAgfSwKICBtb3VudGVkKCkgewogICAgY29uc3Qgdm0gPSB0aGlzOwogICAgLy8g5Yqg5YWlbGVhZmxldOatpempn++8mmh0dHBzOi8vbGVhZmxldGpzLmNvbS9leGFtcGxlcy9xdWljay1zdGFydC8KICAgIC8vIE9TTeWcsOWcluWPg+iAg++8mmh0dHBzOi8vbGVhZmxldGpzLmNvbS8KICAgIHZtLm9zbU1hcCA9IEwubWFwKCdtYXAnKS5zZXRWaWV3KFsyNS4wNDE5NTYsIDEyMS41MDg3OTFdLCAxNik7CiAgICBMLnRpbGVMYXllcignaHR0cHM6Ly97c30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLCB7CiAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9Imh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnLyI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCA8YSBocmVmPSJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wLyI+Q0MtQlktU0E8L2E+LCBJbWFnZXJ5IMKpIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lm1hcGJveC5jb20vIj5NYXBib3g8L2E+JywKICAgICAgbWF4Wm9vbTogMTgsCiAgICAgIGlkOiAnbWFwYm94L3N0cmVldHMtdjExJywKICAgICAgdGlsZVNpemU6IDUxMiwKICAgICAgem9vbU9mZnNldDogLTEsCiAgICAgIGFjY2Vzc1Rva2VuOiAneW91ci5tYXBib3guYWNjZXNzLnRva2VuJywKICAgIH0pLmFkZFRvKHZtLm9zbU1hcCk7CiAgfSwKfTsK"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div id=\"app\">\n    <div class=\"row no-gutters\">\n      <!-- 選擇地區 -->\n      <div class=\"toolbox col-sm-3 p-2 bg-white\">\n        <div class=\"form-group d-flex\">\n          <label for=\"city\" class=\"col-form-label mr-2 text-right\">縣市</label>\n          <div class=\"flex-fill\">\n            <select id=\"city\" class=\"form-control\" v-model=\"selected.city\">\n              <!-- 製作下拉選單 -->\n              <option v-for=\"city in cityMenu\" :key=\"city\" :value=\"city\">{{ city }}</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"form-group d-flex\">\n          <label for=\"dist\" class=\"col-form-label mr-2 text-right\">地區</label>\n          <div class=\"flex-fill\">\n            <select id=\"dist\" class=\"form-control\" v-model=\"selected.area\">\n              <!-- 製作下拉選單 -->\n              <option v-for=\"area in areaMenu\" :key=\"area\" :value=\"area\">{{ area }}</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      <!-- 顯示地圖和 UBike 站點 -->\n      <div class=\"col-sm-9\">\n        <div id=\"map\"></div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Taipei from '@/assets/area.json';\nimport L from 'leaflet';\n\nexport default {\n  name: 'Ubike-map',\n  data() {\n    return {\n      cityMenu: [],\n      areaMenu: [],\n      ubikes: [],\n      selected: { city: '臺北市', area: '萬華區' },\n      osmMap: {},\n    };\n  },\n  computed: {\n    selectedArea() {\n      const vm = this;\n      return vm.ubikes.filter((item) => item.sarea === vm.selected.area);\n    },\n  },\n  watch: {\n    selectedArea() {\n      const vm = this;\n      vm.updateMarkers();\n    },\n  },\n  methods: {\n    updateMarkers() {\n      const vm = this;\n\n      // 移除標記，使用 instanceof 判斷是否是marker物件，如果是就移除\n      vm.osmMap.eachLayer((layer) => {\n        if (layer instanceof L.Marker) {\n          vm.osmMap.removeLayer(layer);\n        }\n      });\n\n      // 新增標記、popup\n      vm.selectedArea.forEach((area) => {\n        L.marker([area.lat, area.lng]).addTo(vm.osmMap).bindPopup(`<p><strong style=\"font-size: 20px;\">${area.sna}</strong></p>\n <strong style=\"font-size: 16px; color: #d45345;\">可租借車輛剩餘：${area.sbi} 台</strong><br>\n 可停空位剩餘: ${area.bemp}<br>\n <small>最後更新時間: ${area.mday}</small>`);\n      });\n\n      // 移動中心點\n      vm.osmMap.panTo([vm.selectedArea[0].lat, vm.selectedArea[0].lng]);\n    },\n  },\n  created() {\n    const vm = this;\n    vm.cityMenu = [Taipei[0].name];\n    vm.areaMenu = Taipei[0].districts.map((area) => area.name);\n    const api = 'https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json';\n    vm.$http.get(api).then((response) => {\n      vm.ubikes = response.data.retVal;\n      // 使用 Object.keys獲取{{},{},{},{},{}}的方式\n      vm.ubikes = Object.keys(vm.ubikes).map((key) => vm.ubikes[key]);\n    });\n  },\n  mounted() {\n    const vm = this;\n    // 加入leaflet步驟：https://leafletjs.com/examples/quick-start/\n    // OSM地圖參考：https://leafletjs.com/\n    vm.osmMap = L.map('map').setView([25.041956, 121.508791], 16);\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n      maxZoom: 18,\n      id: 'mapbox/streets-v11',\n      tileSize: 512,\n      zoomOffset: -1,\n      accessToken: 'your.mapbox.access.token',\n    }).addTo(vm.osmMap);\n  },\n};\n</script>\n\n<style lang=\"scss\">\n@import 'bootstrap/scss/bootstrap';\n\n#map {\n  background-color: rgb(235, 235, 235);\n  height: 100vh;\n}\n</style>\n"]}]}